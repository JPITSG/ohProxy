(function(){
var p=new URLSearchParams(window.location.search);var m=p.get('mode');if(m==='dark'||m==='light'){document.documentElement.setAttribute('data-theme',m)}else{var sv=localStorage.getItem('theme');var d=window.matchMedia('(prefers-color-scheme:dark)').matches;document.documentElement.setAttribute('data-theme',sv||(d?'dark':'light'))}
window.ChartRenderer=class{constructor(cid,sid){this.container=document.getElementById(cid);this.svg=document.getElementById(sid);this.tooltip=document.getElementById('tooltip');this.tooltipValue=document.getElementById('tooltipValue');this.tooltipLabel=document.getElementById('tooltipLabel');this.padding={top:25,right:45,bottom:60,left:35};this.points=[];this.init();window.addEventListener('resize',()=>this.render())}
init(){this.render()}
svg$(t,a){var e=document.createElementNS('http://www.w3.org/2000/svg',t);for(var k in a)e.setAttribute(k,a[k]);return e}
render(){var rect=this.container.getBoundingClientRect();var w=rect.width,h=rect.height;var sm=w<500;var pad=sm?{top:15,right:45,bottom:40,left:22}:this.padding;var cw=w-pad.left-pad.right,ch=h-pad.top-pad.bottom;var iL=sm?10:25,iR=sm?10:25;var dw=cw-iL-iR;
this.svg.innerHTML='';var $=(t,a)=>this.svg$(t,a);
var defs=$('defs',{});var grad=$('linearGradient',{id:'areaGradient',x1:'0%',y1:'0%',x2:'0%',y2:'100%'});grad.appendChild($('stop',{offset:'0%',style:'stop-color:var(--chart-gradient-start)'}));grad.appendChild($('stop',{offset:'50%',style:'stop-color:var(--chart-gradient-start);stop-opacity:0.6'}));grad.appendChild($('stop',{offset:'100%',style:'stop-color:var(--chart-gradient-end)'}));defs.appendChild(grad);
var hM=$('mask',{id:'hGridMask',maskUnits:'objectBoundingBox',maskContentUnits:'objectBoundingBox'});var hG=$('linearGradient',{id:'hGridGrad',x1:'0%',y1:'0%',x2:'100%',y2:'0%'});hG.innerHTML='<stop offset="0%" stop-color="white" stop-opacity="0"/><stop offset="3%" stop-color="white" stop-opacity="1"/><stop offset="97%" stop-color="white" stop-opacity="1"/><stop offset="100%" stop-color="white" stop-opacity="0"/>';defs.appendChild(hG);hM.appendChild($('rect',{x:'0',y:'0',width:'1',height:'1',fill:'url(#hGridGrad)'}));defs.appendChild(hM);
var vM=$('mask',{id:'vGridMask',maskUnits:'objectBoundingBox',maskContentUnits:'objectBoundingBox'});var vG=$('linearGradient',{id:'vGridGrad',x1:'0%',y1:'0%',x2:'0%',y2:'100%'});vG.innerHTML='<stop offset="0%" stop-color="white" stop-opacity="0"/><stop offset="3%" stop-color="white" stop-opacity="1"/><stop offset="97%" stop-color="white" stop-opacity="1"/><stop offset="100%" stop-color="white" stop-opacity="0"/>';defs.appendChild(vG);vM.appendChild($('rect',{x:'0',y:'0',width:'1',height:'1',fill:'url(#vGridGrad)'}));defs.appendChild(vM);
var cp=$('clipPath',{id:'chartClip'});cp.appendChild($('rect',{x:'0',y:'0',width:cw,height:ch}));defs.appendChild(cp);this.svg.appendChild(defs);
var g=$('g',{transform:'translate('+pad.left+','+pad.top+')'});var hGG=$('g',{mask:'url(#hGridMask)'});var vGG=$('g',{mask:'url(#vGridMask)'});
var yR=window._chartYMax-window._chartYMin;var nY=sm?5:6;var uS=window._chartUnit&&window._chartUnit!=='?'?' '+window._chartUnit:'';
if(sm){for(var i=0;i<5;i++){var y=window._chartYMin+(yR*i/4);var yP=ch-(i/4)*ch;hGG.appendChild($('line',{class:'grid-line',x1:0,y1:yP,x2:cw,y2:yP}));var l=$('text',{class:'axis-label',x:-8,y:yP+4,'text-anchor':'end'});l.textContent=this.fmt(y)+uS;g.appendChild(l)}}else{var yS=this.nS(Math.abs(yR),nY);var sY=Math.floor(window._chartYMin/yS)*yS;for(var y=sY;y<=window._chartYMax+yS*0.1;y+=yS){if(y<window._chartYMin-yS*0.1)continue;var yP=ch-((y-window._chartYMin)/yR)*ch;if(yP>=-5&&yP<=ch+5){hGG.appendChild($('line',{class:'grid-line',x1:0,y1:yP,x2:cw,y2:yP}));var l=$('text',{class:'axis-label',x:-8,y:yP+4,'text-anchor':'end'});l.textContent=this.fmt(y)+uS;g.appendChild(l)}}}g.appendChild(hGG);
var mX=Math.min(window._chartXLabels.length,Math.floor(dw/70));var xSt=Math.max(1,Math.ceil(window._chartXLabels.length/mX));window._chartXLabels.forEach((ld,i)=>{if(i%xSt!==0&&i!==window._chartXLabels.length-1)return;var lt=typeof ld==='object'?ld.text:ld;var lp=typeof ld==='object'?ld.pos:null;var xP=lp!==null?iL+(lp/100)*dw:iL+(window._chartXLabels.length>1?(i/(window._chartXLabels.length-1))*dw:dw/2);vGG.appendChild($('line',{class:'grid-line',x1:xP,y1:0,x2:xP,y2:ch}));var t=$('text',{class:'axis-label',x:xP,y:ch+25,'text-anchor':'middle'});t.textContent=lt;g.appendChild(t)});g.appendChild(vGG);
this.points=[];var minP=null,maxP=null;for(var i=0;i<window._chartData.length;i++){var d=window._chartData[i];var pt={x:iL+(d.x/100)*dw,y:ch-((d.y-window._chartYMin)/yR)*ch,value:d.y,t:d.t,index:i};this.points.push(pt);if(!minP||pt.value<minP.value)minP=pt;if(!maxP||pt.value>maxP.value)maxP=pt}
if(this.points.length>0){var lP=this.cP(this.points);var cG=$('g',{'clip-path':'url(#chartClip)'});var aP=lP+' L '+this.points[this.points.length-1].x+' '+ch+' L '+this.points[0].x+' '+ch+' Z';cG.appendChild($('path',{class:'chart-area',d:aP}));cG.appendChild($('path',{class:'chart-line-glow',d:lP}));cG.appendChild($('path',{class:'chart-line',d:lP}));g.appendChild(cG);
if(!sm){this.circleData=[];var pG=$('g',{class:'data-points'});var gX=[];for(var i=0;i<window._chartXLabels.length;i++){var ld=window._chartXLabels[i];var lp=typeof ld==='object'?ld.pos:null;if(lp!==null)gX.push({x:iL+(lp/100)*dw,delay:1.2+i*0.05})}
var mD=['1.0s','1.1s'];[minP,maxP].forEach((pt,idx)=>{var c=$('circle',{class:'data-point',cx:pt.x,cy:pt.y,r:5});c.style.animationDelay=mD[idx];c.dataset.idx=this.circleData.length;this.circleData.push(pt);pG.appendChild(c)});
for(var i=1;i<this.points.length;i++){var pv=this.points[i-1],cr=this.points[i];var mnX=Math.min(pv.x,cr.x),mxX=Math.max(pv.x,cr.x);for(var j=gX.length-1;j>=0;j--){var gd=gX[j];if(gd.x>=mnX&&gd.x<=mxX){var f=(gd.x-pv.x)/(cr.x-pv.x);var iY=pv.y+f*(cr.y-pv.y);var iV=pv.value+f*(cr.value-pv.value);var iT=pv.t+f*(cr.t-pv.t);var c=$('circle',{class:'data-point',cx:gd.x,cy:iY,r:5});c.style.animationDelay=gd.delay+'s';c.dataset.idx=this.circleData.length;this.circleData.push({x:gd.x,y:iY,value:iV,t:iT});pG.appendChild(c);gX.splice(j,1)}}}
pG.addEventListener('mouseenter',e=>{if(e.target.classList.contains('data-point'))this.sT(e,this.circleData[e.target.dataset.idx])},true);pG.addEventListener('mouseleave',e=>{if(e.target.classList.contains('data-point'))this.hT()},true);g.appendChild(pG)}}
this.svg.appendChild(g)}
cP(pts){if(pts.length<2)return'';var p=['M '+pts[0].x+' '+pts[0].y];for(var i=1;i<pts.length;i++)p.push('L '+pts[i].x+' '+pts[i].y);return p.join(' ')}
nS(r,t){var rough=r/t;var mag=Math.pow(10,Math.floor(Math.log10(rough)));var res=rough/mag;var nice=res<=1.5?1:res<=3?2:res<=7?5:10;return nice*mag}
fmt(n){if(n===0)return'0.0';if(Number.isInteger(n)||Math.abs(n-Math.round(n))<0.0001){var r=Math.round(n);if(Math.abs(r)>=100)return r.toFixed(0);return r.toFixed(1)}if(Math.abs(n)>=1000)return n.toFixed(0);if(Math.abs(n)>=100)return n.toFixed(0);if(Math.abs(n)>=10)return n.toFixed(1);if(Math.abs(n)>=1)return n.toFixed(1);if(Math.abs(n)>=0.1)return n.toFixed(2);return n.toFixed(2)}
fmtTs(ts){var d=new Date(ts);var h=d.getHours(),mi=d.getMinutes();var time=h+':'+(mi<10?'0':'')+mi;var mon=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][d.getMonth()];return time+', '+mon+' '+d.getDate()}
sT(e,pt){var r=this.container.getBoundingClientRect();var x=e.clientX-r.left,y=e.clientY-r.top;this.tooltipValue.textContent=this.fmt(pt.value)+(window._chartUnit&&window._chartUnit!=='?'?' '+window._chartUnit:'');this.tooltipLabel.textContent=pt.t?this.fmtTs(pt.t):'';var tx=x+15,ty=y-15;if(tx+120>r.width)tx=x-120;if(ty<10)ty=y+15;this.tooltip.style.left=tx+'px';this.tooltip.style.top=ty+'px';this.tooltip.classList.add('visible')}
hT(){this.tooltip.classList.remove('visible')}};
document.addEventListener('DOMContentLoaded',function(){new window.ChartRenderer('chartContainer','chartSvg')});
})();
